import{w as R}from"./with-props-D6VfJkxO.js";import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{z as r,u as D,s as z}from"./index-DUIJGpQy.js";import{r as P,u as J,a as L,b as B}from"./chunk-LSOULM7L-BpBjtIwF.js";import{I as t,S as k,a as F,B as T}from"./index-C5VsBwWd.js";import{C as V}from"./index-Dmyz6W4A.js";import{S as A}from"./index-CsEUUeP5.js";import{d as H,b as U,g as M}from"./cart-CZ8beLYv.js";import{g as E}from"./auth.service-m9myRVhg.js";import{c as X}from"./order.service-fFja0B08.js";import{c as $}from"./createLucideIcon-BrLl2DWw.js";import"./utils-CNtvmiS0.js";import"./index-DwQA15mT.js";import"./product.service-Cwpiyzog.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=$("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Y=[{value:"AR",label:"Argentina"},{value:"BO",label:"Bolivia"},{value:"BR",label:"Brasil"},{value:"CL",label:"Chile"},{value:"CO",label:"Colombia"},{value:"CR",label:"Costa Rica"},{value:"CU",label:"Cuba"},{value:"DO",label:"República Dominicana"},{value:"EC",label:"Ecuador"},{value:"SV",label:"El Salvador"},{value:"GT",label:"Guatemala"},{value:"HT",label:"Haití"},{value:"HN",label:"Honduras"},{value:"MX",label:"México"},{value:"NI",label:"Nicaragua"},{value:"PA",label:"Panamá"},{value:"PY",label:"Paraguay"},{value:"PE",label:"Perú"},{value:"PR",label:"Puerto Rico"},{value:"UY",label:"Uruguay"},{value:"VE",label:"Venezuela"}],K=r.object({email:r.string().email("Correo electrónico inválido"),firstName:r.string().min(1,"El nombre es requerido"),lastName:r.string().min(1,"El apellido es requerido"),company:r.string().optional(),address:r.string().min(1,"La dirección es requerida"),city:r.string().min(1,"La ciudad es requerida"),country:r.string().min(1,"El país es requerido"),region:r.string().min(1,"La provincia/estado es requerido"),zip:r.string().min(1,"El código postal es requerido"),phone:r.string().min(1,"El teléfono es requerido")});async function ce({request:m}){let a;try{a=await E()}catch{a=null}const o=await m.formData(),c=JSON.parse(o.get("shippingDetailsJson")),d=JSON.parse(o.get("cartItemsJson")).map(i=>({productId:i.product.id,quantity:i.quantity,title:i.product.title,price:i.product.price,imgSrc:i.product.imgSrc})),{orderId:l}=await X(d,c);return a?H():U(),P(`/order-confirmation/${l}`)}async function de(){const[m,a]=await Promise.all([E(),M()]);return a?m?{user:m,cart:a}:{cart:a}:P("/")}const ue=R(function(){var p,x,g,b,f,h,j,v,N,y,C,S,w;const{user:a,cart:o}=J(),c=L(),u=B(),d=c.state==="submitting",{register:l,handleSubmit:i,formState:{errors:s,isValid:I}}=D({resolver:z(K),defaultValues:{email:a==null?void 0:a.email,firstName:"",lastName:"",company:"",address:"",city:"",country:"",region:"",zip:"",phone:""},mode:"onTouched"});async function O(n){u({shippingDetailsJson:JSON.stringify(n),cartItemsJson:JSON.stringify(o.items)},{method:"POST"})}return e.jsx(A,{className:"bg-muted",children:e.jsx(V,{children:e.jsxs("div",{className:"flex flex-col gap-12 max-w-2xl mx-auto lg:flex-row lg:max-w-none",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx("h2",{className:"text-lg font-medium mb-4",children:"Resumen de la orden"}),e.jsxs("div",{className:"border border-border rounded-xl bg-background flex flex-col",children:[(p=o==null?void 0:o.items)==null?void 0:p.map(({product:n,quantity:q})=>e.jsxs("div",{className:"flex gap-6 p-6 border-b border-border",children:[e.jsx("div",{className:"w-20 rounded-xl bg-muted",children:e.jsx("img",{src:n.imgSrc,alt:n.title,className:"w-full aspect-square object-contain"})}),e.jsxs("div",{className:"flex flex-col justify-between flex-grow",children:[e.jsx("h3",{className:"text-sm leading-5",children:n.title}),e.jsxs("div",{className:"flex text-sm font-medium gap-4 items-center self-end",children:[e.jsx("p",{children:q}),e.jsx(G,{className:"w-4 h-4"}),e.jsxs("p",{children:["$",n.price.toFixed(2)]})]})]})]},n.id)),e.jsxs("div",{className:"flex justify-between p-6 text-base font-medium",children:[e.jsx("p",{children:"Total"}),e.jsxs("p",{children:["$",((o==null?void 0:o.total)||0).toFixed(2)]})]})]})]}),e.jsxs("form",{className:"flex-grow lg:max-w-4xl lg:order-first",onSubmit:i(O),children:[e.jsxs("fieldset",{children:[e.jsx("legend",{className:"text-xl font-medium mb-6",children:"Información de contacto"}),e.jsx(t,{label:"Correo electrónico",type:"email",autoComplete:"email",defaultValue:a==null?void 0:a.email,readOnly:!!a,error:(x=s.email)==null?void 0:x.message,...l("email")})]}),e.jsx(k,{className:"my-6"}),e.jsxs("fieldset",{children:[e.jsx("legend",{className:"text-xl font-medium mb-6",children:"Información de envío"}),e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsx(t,{label:"Nombre",autoComplete:"given-name",error:(g=s.firstName)==null?void 0:g.message,...l("firstName")}),e.jsx(t,{label:"Apellido",autoComplete:"family-name",error:(b=s.lastName)==null?void 0:b.message,...l("lastName")}),e.jsx(t,{label:"Compañia",autoComplete:"organization",error:(f=s.company)==null?void 0:f.message,...l("company")}),((h=s.company)==null?void 0:h.message)&&e.jsx("p",{children:(j=s.company)==null?void 0:j.message}),e.jsx(t,{label:"Dirección",autoComplete:"street-address",error:(v=s.address)==null?void 0:v.message,...l("address")}),e.jsx(t,{label:"Ciudad",autoComplete:"address-level2",error:(N=s.city)==null?void 0:N.message,...l("city")}),e.jsx(F,{label:"País",options:Y,placeholder:"Seleccionar país",error:(y=s.country)==null?void 0:y.message,...l("country")}),e.jsx(t,{label:"Provincia/Estado",autoComplete:"address-level1",error:(C=s.region)==null?void 0:C.message,...l("region")}),e.jsx(t,{label:"Código Postal",autoComplete:"postal-code",error:(S=s.zip)==null?void 0:S.message,...l("zip")}),e.jsx(t,{label:"Teléfono",autoComplete:"tel",error:(w=s.phone)==null?void 0:w.message,...l("phone")})]})]}),e.jsx(T,{size:"xl",className:"w-full mt-6",disabled:!I,children:d?"Procesando...":"Confirmar Orden"})]})]})})})});export{ce as clientAction,de as clientLoader,ue as default};
