import{w as q}from"./with-props-BBqpwT5E.js";import{r as R,u as L,a as D,j as e}from"./chunk-LSOULM7L-OaPJ-Plh.js";import{z as s,u as z,s as J}from"./index-DudFI82r.js";import{I as t,S as T,a as A,B}from"./index-Dbs4k1je.js";import{C as k}from"./index-C65Y4aBu.js";import{S as F}from"./index-D-b6Fp5p.js";import{g as V}from"./auth.service-2jA2gaO1.js";import{c as H,L as U}from"./utils-CNtvmiS0.js";import{c as M}from"./order.service-fFja0B08.js";import{c as X}from"./createLucideIcon-BSoWJu4V.js";import"./index-BIC2x-iH.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=X("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);async function $(){return H("/cart",{method:"DELETE"})}function G(){localStorage.removeItem(U)}const _=[{value:"AR",label:"Argentina"},{value:"BO",label:"Bolivia"},{value:"BR",label:"Brasil"},{value:"CL",label:"Chile"},{value:"CO",label:"Colombia"},{value:"CR",label:"Costa Rica"},{value:"CU",label:"Cuba"},{value:"DO",label:"República Dominicana"},{value:"EC",label:"Ecuador"},{value:"SV",label:"El Salvador"},{value:"GT",label:"Guatemala"},{value:"HT",label:"Haití"},{value:"HN",label:"Honduras"},{value:"MX",label:"México"},{value:"NI",label:"Nicaragua"},{value:"PA",label:"Panamá"},{value:"PY",label:"Paraguay"},{value:"PE",label:"Perú"},{value:"PR",label:"Puerto Rico"},{value:"UY",label:"Uruguay"},{value:"VE",label:"Venezuela"}],K=s.object({email:s.string().email("Correo electrónico inválido"),firstName:s.string().min(1,"El nombre es requerido"),lastName:s.string().min(1,"El apellido es requerido"),company:s.string().optional(),address:s.string().min(1,"La dirección es requerida"),city:s.string().min(1,"La ciudad es requerida"),country:s.string().min(1,"El país es requerido"),region:s.string().min(1,"La provincia/estado es requerido"),zip:s.string().min(1,"El código postal es requerido"),phone:s.string().min(1,"El teléfono es requerido")});async function ne({request:d}){let n;try{n=await V()}catch{n=null}const r=await d.formData(),o=JSON.parse(r.get("shippingDetailsJson")),m=JSON.parse(r.get("cartItemsJson")).map(a=>({productId:a.product.id,quantity:a.quantity,title:a.product.title,price:a.product.price,imgSrc:a.product.imgSrc})),{orderId:c}=await M(m,o);return n?$():G(),R(`/order-confirmation/${c}`)}const me=q(function({loaderData:n}){var p,x,g,f,b,h,v,j,N,C,y,S,w;const{user:r,cart:o}=n,u=L(),m=D(),c=u.state==="submitting",{register:a,handleSubmit:E,formState:{errors:l,isValid:P}}=z({resolver:J(K),defaultValues:{email:r==null?void 0:r.email,firstName:"",lastName:"",company:"",address:"",city:"",country:"",region:"",zip:"",phone:""},mode:"onTouched"});async function I(i){m({shippingDetailsJson:JSON.stringify(i),cartItemsJson:JSON.stringify(o.items)},{method:"POST"})}return e.jsx(F,{className:"bg-muted",children:e.jsx(k,{children:e.jsxs("div",{className:"flex flex-col gap-12 max-w-2xl mx-auto lg:flex-row lg:max-w-none",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx("h2",{className:"text-lg font-medium mb-4",children:"Resumen de la orden"}),e.jsxs("div",{className:"border border-border rounded-xl bg-background flex flex-col",children:[(p=o==null?void 0:o.items)==null?void 0:p.map(({product:i,quantity:O})=>e.jsxs("div",{className:"flex gap-6 p-6 border-b border-border",children:[e.jsx("div",{className:"w-20 rounded-xl bg-muted",children:e.jsx("img",{src:i.imgSrc,alt:i.title,className:"w-full aspect-square object-contain"})}),e.jsxs("div",{className:"flex flex-col justify-between flex-grow",children:[e.jsx("h3",{className:"text-sm leading-5",children:i.title}),e.jsxs("div",{className:"flex text-sm font-medium gap-4 items-center self-end",children:[e.jsx("p",{children:O}),e.jsx(Y,{className:"w-4 h-4"}),e.jsxs("p",{children:["$",i.price.toFixed(2)]})]})]})]},i.id)),e.jsxs("div",{className:"flex justify-between p-6 text-base font-medium",children:[e.jsx("p",{children:"Total"}),e.jsxs("p",{children:["$",((o==null?void 0:o.total)||0).toFixed(2)]})]})]})]}),e.jsxs("form",{className:"flex-grow lg:max-w-4xl lg:order-first",onSubmit:E(I),children:[e.jsxs("fieldset",{children:[e.jsx("legend",{className:"text-xl font-medium mb-6",children:"Información de contacto"}),e.jsx(t,{label:"Correo electrónico",type:"email",autoComplete:"email",defaultValue:r==null?void 0:r.email,readOnly:!!r,error:(x=l.email)==null?void 0:x.message,...a("email")})]}),e.jsx(T,{className:"my-6"}),e.jsxs("fieldset",{children:[e.jsx("legend",{className:"text-xl font-medium mb-6",children:"Información de envío"}),e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsx(t,{label:"Nombre",autoComplete:"given-name",error:(g=l.firstName)==null?void 0:g.message,...a("firstName")}),e.jsx(t,{label:"Apellido",autoComplete:"family-name",error:(f=l.lastName)==null?void 0:f.message,...a("lastName")}),e.jsx(t,{label:"Compañia",autoComplete:"organization",error:(b=l.company)==null?void 0:b.message,...a("company")}),((h=l.company)==null?void 0:h.message)&&e.jsx("p",{children:(v=l.company)==null?void 0:v.message}),e.jsx(t,{label:"Dirección",autoComplete:"street-address",error:(j=l.address)==null?void 0:j.message,...a("address")}),e.jsx(t,{label:"Ciudad",autoComplete:"address-level2",error:(N=l.city)==null?void 0:N.message,...a("city")}),e.jsx(A,{label:"País",options:_,placeholder:"Seleccionar país",error:(C=l.country)==null?void 0:C.message,...a("country")}),e.jsx(t,{label:"Provincia/Estado",autoComplete:"address-level1",error:(y=l.region)==null?void 0:y.message,...a("region")}),e.jsx(t,{label:"Código Postal",autoComplete:"postal-code",error:(S=l.zip)==null?void 0:S.message,...a("zip")}),e.jsx(t,{label:"Teléfono",autoComplete:"tel",error:(w=l.phone)==null?void 0:w.message,...a("phone")})]})]}),e.jsx(B,{size:"xl",className:"w-full mt-6",disabled:!P,children:c?"Procesando...":"Confirmar Orden"})]})]})})})});export{ne as clientAction,me as default};
